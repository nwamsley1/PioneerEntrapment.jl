<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PioneerEntrapment.jl</title><meta name="title" content="Home · PioneerEntrapment.jl"/><meta property="og:title" content="Home · PioneerEntrapment.jl"/><meta property="twitter:title" content="Home · PioneerEntrapment.jl"/><meta name="description" content="Documentation for PioneerEntrapment.jl."/><meta property="og:description" content="Documentation for PioneerEntrapment.jl."/><meta property="twitter:description" content="Documentation for PioneerEntrapment.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>PioneerEntrapment.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Julia-REPL-(quick-start)"><span>Julia REPL (quick start)</span></a></li><li><a class="tocitem" href="#CLI-(single-run)"><span>CLI (single run)</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li><li><a class="tocitem" href="#Example:-Julia-REPL-on-local-data"><span>Example: Julia REPL on local data</span></a></li><li><a class="tocitem" href="#Live-Reload-with-Revise"><span>Live Reload with Revise</span></a></li><li><a class="tocitem" href="#Multi-run-comparison-(replicates)"><span>Multi-run comparison (replicates)</span></a></li><li><a class="tocitem" href="#Folder-convenience-(both-precursor-and-protein)"><span>Folder convenience (both precursor and protein)</span></a></li><li><a class="tocitem" href="#Vector-friendly-PDF-output"><span>Vector-friendly PDF output</span></a></li></ul></li><li><a class="tocitem" href="entrapment_computation/">Entrapment EFDR</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/nwamsley1/PioneerEntrapment.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="PioneerEntrapment.jl"><a class="docs-heading-anchor" href="#PioneerEntrapment.jl">PioneerEntrapment.jl</a><a id="PioneerEntrapment.jl-1"></a><a class="docs-heading-anchor-permalink" href="#PioneerEntrapment.jl" title="Permalink"></a></h1><p>Entrapment-based empirical FDR analysis for DIA proteomics.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="language-julia hljs">] add https://github.com/nwamsley1/PioneerEntrapment.jl</code></pre><h2 id="Julia-REPL-(quick-start)"><a class="docs-heading-anchor" href="#Julia-REPL-(quick-start)">Julia REPL (quick start)</a><a id="Julia-REPL-(quick-start)-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-REPL-(quick-start)" title="Permalink"></a></h2><pre><code class="language-julia hljs">using PioneerEntrapment
run_efdr_analysis(&quot;precursors.arrow&quot;, &quot;library.arrow&quot;; output_dir=&quot;out&quot;)
run_protein_efdr_analysis(&quot;proteins.arrow&quot;; output_dir=&quot;out&quot;)
run_both_analyses(; precursor_results_path=&quot;precursors.arrow&quot;, library_precursors_path=&quot;library.arrow&quot;, protein_results_path=&quot;proteins.arrow&quot;, output_dir=&quot;out&quot;)</code></pre><h2 id="CLI-(single-run)"><a class="docs-heading-anchor" href="#CLI-(single-run)">CLI (single run)</a><a id="CLI-(single-run)-1"></a><a class="docs-heading-anchor-permalink" href="#CLI-(single-run)" title="Permalink"></a></h2><pre><code class="language-bash hljs">pioneer-entrapment --mode precursor --precursor-results prec.arrow --library lib.arrow --outdir out
pioneer-entrapment --mode protein --protein-results protein.arrow --outdir out
pioneer-entrapment --mode both --precursor-results prec.arrow --library lib.arrow --protein-results protein.arrow --outdir out</code></pre><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><ul><li><code>run_efdr_analysis</code></li><li><code>run_protein_efdr_analysis</code></li><li><code>run_both_analyses</code></li></ul><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment._get_required_lib_columns" href="#PioneerEntrapment._get_required_lib_columns"><code>PioneerEntrapment._get_required_lib_columns</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_get_required_lib_columns(entrap_species, need_mod_key) -&gt; Vector{Symbol}</code></pre><p>Determine required columns for loading library precursors.</p><p>Arguments</p><ul><li>entrap_species: Optional species name for species-based entrapment</li><li>need<em>mod</em>key: Whether mod_key column needs to be loaded (for computing if missing)</li></ul><p>Returns</p><ul><li>Vector of required column names</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L189-L200">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment._get_required_prec_columns" href="#PioneerEntrapment._get_required_prec_columns"><code>PioneerEntrapment._get_required_prec_columns</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_get_required_prec_columns(score_qval_pairs, has_file_idx, entrap_species) -&gt; Vector{Symbol}</code></pre><p>Determine required columns for loading precursor results.</p><p>Arguments</p><ul><li>score<em>qval</em>pairs: Vector of (score<em>col, qval</em>col) tuples</li><li>has<em>file</em>idx: Whether ms<em>file</em>idx is available (use :file_name as fallback if false)</li><li>entrap_species: Optional species name for species-based entrapment</li></ul><p>Returns</p><ul><li>Vector of required column names</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L161-L173">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment._get_required_protein_columns" href="#PioneerEntrapment._get_required_protein_columns"><code>PioneerEntrapment._get_required_protein_columns</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_get_required_protein_columns(score_qval_pairs, has_file_idx, entrap_species) -&gt; Vector{Symbol}</code></pre><p>Determine required columns for loading protein results.</p><p>Arguments</p><ul><li>score<em>qval</em>pairs: Vector of (score<em>col, qval</em>col) tuples</li><li>has<em>file</em>idx: Whether ms<em>file</em>idx is available (use :file_name as fallback if false)</li><li>entrap_species: Optional species name for species-based entrapment</li></ul><p>Returns</p><ul><li>Vector of required column names</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L218-L230">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment._load_table-Tuple{AbstractString}" href="#PioneerEntrapment._load_table-Tuple{AbstractString}"><code>PioneerEntrapment._load_table</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Load a tabular file into a DataFrame. Supports Arrow/Feather (<code>.arrow</code>, <code>.feather</code>) and delimited text (<code>.csv</code>, <code>.tsv</code>, <code>.txt</code>). Also accepts a directory path (e.g., a <code>.poin</code> folder) and will locate a suitable table inside, preferring <code>precursors_table.arrow</code>, then any <code>.arrow</code>/<code>.feather</code>, then <code>.tsv</code>/<code>.csv</code>. Falls back to trying Arrow, then CSV regardless of extension.</p><p>Arguments</p><ul><li>path: Path to file or directory</li><li>columns: Optional vector of column names to load (Arrow only). If <code>nothing</code>, loads all columns.         For selective loading (faster, less memory), pass e.g. <code>[:precursor_idx, :target, :prec_prob]</code>.</li></ul><p>Performance Note</p><ul><li>Selective column loading can be 100-150x faster for large Arrow files.</li><li>Example: Loading 7 columns vs all 42 reduces time from 11.5s to 0.13s and memory from 180MB to 14MB.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L6-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_efdr_columns!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}" href="#PioneerEntrapment.add_efdr_columns!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}"><code>PioneerEntrapment.add_efdr_columns!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_efdr_columns!(df, library_precursors; method_types=[CombinedEFDR,PairedEFDR], score_qval_pairs=[(:score,:qval)], r=1.0, paired_stride=5, use_fast_paired=true, entrap_labels_override=nothing) -&gt; Nothing</code></pre><p>Compute EFDR columns for one or more <code>(score, qval)</code> pairs and attach them to a precursor-level DataFrame. If <code>:&lt;score&gt;_original_target</code> is absent, PairedEFDR is skipped for that score; CombinedEFDR falls back to <code>score</code> only.</p><p>Required columns</p><ul><li>df: <code>:precursor_idx</code>, each <code>score</code> and <code>qval</code> used</li><li>library<em>precursors: `:entrapment</em>group<em>id<code>unless</code>entrap</em>labels_override` provided</li></ul><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L230-L243">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_entrap_pair_ids!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}" href="#PioneerEntrapment.add_entrap_pair_ids!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}"><code>PioneerEntrapment.add_entrap_pair_ids!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_entrap_pair_ids!(prec_results::DataFrame, library_precursors::DataFrame) -&gt; Nothing</code></pre><p>Attach precomputed entrapment pair IDs to a precursor-level results table.</p><p>The <code>library_precursors</code> table must contain <code>:entrapment_pair_id</code> (precomputed during library construction). This function copies that ID onto each row of <code>prec_results</code> by indexing via <code>:precursor_idx</code>.</p><p>Required columns</p><ul><li>prec<em>results: `:precursor</em>idx`</li><li>library<em>precursors: `:entrapment</em>pair_id`</li></ul><p>Side effects</p><ul><li>Adds a <code>:entrapment_pair_id::Union{Missing,UInt32}</code> column to <code>prec_results</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/entrapment_pairing.jl#L32-L47">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_original_target_protein_scores!-Tuple{DataFrames.DataFrame, Vector{Symbol}}" href="#PioneerEntrapment.add_original_target_protein_scores!-Tuple{DataFrames.DataFrame, Vector{Symbol}}"><code>PioneerEntrapment.add_original_target_protein_scores!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_original_target_protein_scores!(protein_results::DataFrame, score_cols::Vector{Symbol}) -&gt; Nothing</code></pre><p>Vectorized overload to compute original target columns for multiple score fields.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_scoring.jl#L77-L81">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_original_target_protein_scores!-Tuple{DataFrames.DataFrame}" href="#PioneerEntrapment.add_original_target_protein_scores!-Tuple{DataFrames.DataFrame}"><code>PioneerEntrapment.add_original_target_protein_scores!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_original_target_protein_scores!(protein_results::DataFrame; score_col=:pg_score) -&gt; Nothing</code></pre><p>Add a <code>&quot;&lt;score&gt;_original_target&quot;</code> column capturing, for each protein row, the score of the original target protein (entrap_id == 0) with the same <code>file</code> and <code>species</code>. For protein group identifiers that contain multiple entries separated by <code>;</code>, the first entry (i.e., <code>split(protein,&#39;;&#39;)[1]</code>) is used as the group key so targets/entrapments match on the same canonical ID.</p><p>If the row itself is the original target, its own score is used. If there is no matching original target, the value is set to <code>-1.0f0</code>.</p><p>Required columns</p><ul><li>protein<em>results: <code>:protein</code>, `:entrap</em>id<code>,</code>:species<code>,</code>score<em>col<code>, and either</code>:ms</em>file<em>idx<code>or</code>:file</em>name`.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_scoring.jl#L4-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_original_target_scores!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}" href="#PioneerEntrapment.add_original_target_scores!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}"><code>PioneerEntrapment.add_original_target_scores!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_original_target_scores!(prec_results::DataFrame, library_precursors::DataFrame; score_col=:score) -&gt; Nothing</code></pre><p>Attach the original target score for each row based on entrapment pairing.</p><p>For each row in <code>prec_results</code> with <code>:entrapment_pair_id</code>, we determine the original target (the library entry with <code>:entrapment_group_id == 0</code>) within the same pair and MS file, and write that score to a new column <code>Symbol(String(score_col) * &quot;_original_target&quot;)</code>.</p><p>When a row itself is the original target, the new column equals its own score. When the original target does not exist (e.g., missing partner), the value is set to <code>-1.0</code> to flag absence.</p><p>Required columns</p><ul><li>prec<em>results: `:entrapment</em>pair<em>id<code>,</code>:precursor</em>idx<code>,</code>score<em>col<code>, and either</code>:ms</em>file_idx` or implicitly use 0</li><li>library<em>precursors: `:entrapment</em>group_id`</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/scoring.jl#L34-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_protein_efdr_columns!-Tuple{DataFrames.DataFrame}" href="#PioneerEntrapment.add_protein_efdr_columns!-Tuple{DataFrames.DataFrame}"><code>PioneerEntrapment.add_protein_efdr_columns!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_protein_efdr_columns!(protein_results; method_types=[CombinedEFDR,PairedEFDR], score_qval_pairs=[(:pg_score,:qval)], r=1.0, paired_stride=5, use_fast_paired=true, entrap_labels_override=nothing) -&gt; Nothing</code></pre><p>Compute EFDR for protein-level results and attach columns named like <code>&quot;&lt;score&gt;_combined_efdr&quot;</code> and <code>&quot;&lt;score&gt;_paired_efdr&quot;</code>.</p><p>If <code>&lt;score&gt;_original_target</code> is missing, PairedEFDR for that score is skipped. When <code>entrap_labels_override == nothing</code>, <code>:entrap_id</code> is used to label target vs entrapment proteins (0 vs non-zero).</p><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_efdr.jl#L8-L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.add_protein_entrap_pair_ids!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}" href="#PioneerEntrapment.add_protein_entrap_pair_ids!-Tuple{DataFrames.DataFrame, DataFrames.DataFrame}"><code>PioneerEntrapment.add_protein_entrap_pair_ids!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_protein_entrap_pair_ids!(protein_results::DataFrame, protein_library::DataFrame) -&gt; Nothing</code></pre><p>Propagate preassigned <code>:entrapment_pair_id</code> from a protein library table to a results table.</p><p>This maps on <code>:protein</code>. If the library contains multiple rows per protein, the first encountered <code>:entrapment_pair_id</code> is used.</p><p>Required columns</p><ul><li>protein_results: <code>:protein</code></li><li>protein<em>library: <code>:protein</code>, `:entrapment</em>pair_id`</li></ul><p>Side effects</p><ul><li>Adds <code>:entrapment_pair_id</code> column to <code>protein_results</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_entrapment_pairing.jl#L71-L85">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.assign_protein_entrapment_pairs!-Tuple{DataFrames.DataFrame}" href="#PioneerEntrapment.assign_protein_entrapment_pairs!-Tuple{DataFrames.DataFrame}"><code>PioneerEntrapment.assign_protein_entrapment_pairs!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">assign_protein_entrapment_pairs!(df::DataFrame) -&gt; Nothing</code></pre><p>Assign a stable <code>:entrapment_pair_id</code> for each protein across target and entrapment entries.</p><p>Rules (per unique <code>:protein</code>):</p><ul><li>Split rows by <code>:entrap_id == 0</code> (original target) vs <code>:entrap_id != 0</code> (entrapment groups).</li><li>If a protein lacks at least one target AND one entrapment, it is skipped.</li><li>For each target row, assign a new pair ID and round‑robin assign that same ID to exactly one row from each entrapment group for that protein. This avoids bias when there are unequal numbers of entries per group.</li></ul><p>Required columns</p><ul><li>df: <code>:protein</code>, <code>:entrap_id</code></li></ul><p>Side effects</p><ul><li>Adds/fills <code>:entrapment_pair_id::Union{Missing,UInt32}</code> in <code>df</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_entrapment_pairing.jl#L9-L26">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.calculate_efdr-Tuple{CombinedEFDR}" href="#PioneerEntrapment.calculate_efdr-Tuple{CombinedEFDR}"><code>PioneerEntrapment.calculate_efdr</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">calculate_efdr(method::CombinedEFDR) -&gt; Vector{Float64}</code></pre><p>Compute empirical FDR for the Combined method by scanning the order defined by <code>(-score, qval)</code> and applying the ratio-based estimator to cumulative counts of entrapments and targets. Enforces monotonicity over the sort order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L69-L75">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.calculate_efdr-Tuple{PairedEFDR}" href="#PioneerEntrapment.calculate_efdr-Tuple{PairedEFDR}"><code>PioneerEntrapment.calculate_efdr</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">calculate_efdr(method::PairedEFDR; stride::Int=5) -&gt; Vector{Float64}</code></pre><p>Estimate EFDR for the Paired method. For efficiency, computes EFDR at sampled positions <code>1:stride:n</code> along the order defined by <code>(-score, qval)</code> and fills forward between checkpoints, then enforces monotonicity.</p><p>Counts per checkpoint at score cut <code>s</code>:</p><ul><li>Nτ: targets ≥ s</li><li>Nϵ: entrapments ≥ s</li><li>Nϵsτ: entrapments ≥ s with target &lt; s (or missing)</li><li>Nϵτs: entrapments &gt; target with target ≥ s</li></ul><p>EFDR(s) = (Nϵ + Nϵsτ + 2·Nϵτs) / (Nϵ + Nτ), capped to [0,1].</p><p>Set <code>stride=1</code> for the exact O(n²) computation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L114-L130">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.calculate_efdr_fast-Tuple{PairedEFDR}" href="#PioneerEntrapment.calculate_efdr_fast-Tuple{PairedEFDR}"><code>PioneerEntrapment.calculate_efdr_fast</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">calculate_efdr_fast(method::PairedEFDR; cuts_mode::Symbol=:targets_only)</code></pre><p>Compute paired EFDR using an O(n log n + K) approach that aggregates counts over score cutoffs rather than scanning quadratically per threshold.</p><p>cuts_mode controls which unique score cutoffs are used:</p><ul><li>:targets<em>only =&gt; unique(t) where t = original</em>target_score (non-missing)</li><li>:all          =&gt; unique union of t and e (entrap scores)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/paired_fast.jl#L1-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.calculate_protein_efdr_calibration_error-Tuple{DataFrames.DataFrame, Symbol, Symbol}" href="#PioneerEntrapment.calculate_protein_efdr_calibration_error-Tuple{DataFrames.DataFrame, Symbol, Symbol}"><code>PioneerEntrapment.calculate_protein_efdr_calibration_error</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">calculate_protein_efdr_calibration_error(protein_results, qval_col, efdr_col; entrap_labels_override=nothing) -&gt; (DataFrame, Float64)</code></pre><p>Compute realized FDR across thresholds 0.001:0.001:0.1 for a given EFDR column and return a table with the absolute error vs the nominal threshold, along with the mean absolute error.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_efdr.jl#L132-L138">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.compare_protein_efdr_methods-Tuple{DataFrames.DataFrame, Symbol, Symbol}" href="#PioneerEntrapment.compare_protein_efdr_methods-Tuple{DataFrames.DataFrame, Symbol, Symbol}"><code>PioneerEntrapment.compare_protein_efdr_methods</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compare_protein_efdr_methods(protein_results, qval_col, score_col; entrap_labels_override=nothing, include_paired=true) -&gt; DataFrame</code></pre><p>Summarize method calibration by comparing selections at a set of EFDR/q-value thresholds against the actual entrapment fraction.</p><p>Returns one row per threshold with counts and realized FDR for q-value-based selection, combined EFDR, and optionally paired EFDR.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_efdr.jl#L76-L84">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.create_global_protein_results_df-Tuple{DataFrames.DataFrame}" href="#PioneerEntrapment.create_global_protein_results_df-Tuple{DataFrames.DataFrame}"><code>PioneerEntrapment.create_global_protein_results_df</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_global_protein_results_df(protein_results::DataFrame; score_col::Symbol=:global_pg_score) -&gt; DataFrame</code></pre><p>Select the best row across files per grouping of <code>(species?, protein, entrap_id?)</code>.</p><ul><li>Groups by <code>:species</code> if present, always by <code>:protein</code>, and by <code>:entrap_id</code> if present.</li><li>For each group, picks the row with the maximum <code>score_col</code>.</li><li>If <code>:ms_file_idx</code> exists, sets it to 0 for returned rows; otherwise assigns <code>:file_name =&gt; &quot;global&quot;</code>.</li></ul><p>Notes</p><ul><li>Decoys: upstream APIs filter out decoys (<code>:target == false</code>) before calling this. If a <code>:target</code> column is present, rows with <code>target == false</code> are dropped defensively.</li></ul><p>Required columns</p><ul><li>protein<em>results: <code>:protein</code>, `score</em>col<code>, and either</code>:ms<em>file</em>idx<code>or</code>:file_name`.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/protein_scoring.jl#L89-L103">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.create_global_results_df-Tuple{DataFrames.DataFrame}" href="#PioneerEntrapment.create_global_results_df-Tuple{DataFrames.DataFrame}"><code>PioneerEntrapment.create_global_results_df</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_global_results_df(prec_results::DataFrame; score_col::Symbol=:global_prob) -&gt; DataFrame</code></pre><p>Build a per-precursor global table by selecting, for each <code>:precursor_idx</code>, the row with the best available <code>score_col</code> across files.</p><p>If <code>:ms_file_idx</code> exists, the returned rows have <code>:ms_file_idx = 0</code>. If only <code>:file_name</code> exists, a synthetic <code>&quot;global&quot;</code> file name is assigned.</p><p>Required columns</p><ul><li>prec<em>results: `:precursor</em>idx<code>,</code>:ms<em>file</em>idx<code>(or</code>:file<em>name<code>),</code>score</em>col`</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/scoring.jl#L112-L123">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.generate_markdown_report-Tuple{DataFrames.DataFrame, DataFrames.DataFrame, Dict, Dict, Vector{Tuple{Symbol, Symbol}}, Vector, Int64, String, String}" href="#PioneerEntrapment.generate_markdown_report-Tuple{DataFrames.DataFrame, DataFrames.DataFrame, Dict, Dict, Vector{Tuple{Symbol, Symbol}}, Vector, Int64, String, String}"><code>PioneerEntrapment.generate_markdown_report</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">generate_markdown_report(prec_results, library_precursors, comparison_results,
                       calibration_results, score_qval_pairs, method_types,
                       original_rows, output_dir, output_path)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L720-L724">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.getModKey-Tuple{AbstractString}" href="#PioneerEntrapment.getModKey-Tuple{AbstractString}"><code>PioneerEntrapment.getModKey</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">getModKey(mod_string::AbstractString) -&gt; String</code></pre><p>Extract a canonical modification key from a modification annotation string.</p><p>The function searches for substrings of the form <code>(pos,AA,MODNAME)</code> and returns the sorted, semicolon-delimited list of <code>MODNAME</code> values. This allows grouping precursors that differ only by order or position of identical modifications.</p><p>Arguments</p><ul><li>mod_string: Freeform modification annotation containing tokens like <code>(5,M,Oxidation)</code>.</li></ul><p>Returns</p><ul><li>A string such as <code>&quot;Acetyl;Oxidation&quot;</code>. Returns <code>&quot;&quot;</code> if no mods are found.</li></ul><p>Example     julia&gt; getModKey(&quot;(5,M,Oxidation)(1,K,Acetyl)&quot;)     &quot;Acetyl;Oxidation&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/entrapment_pairing.jl#L1-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.get_combined_efdr" href="#PioneerEntrapment.get_combined_efdr"><code>PioneerEntrapment.get_combined_efdr</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_combined_efdr(score, original_target_score, entrapment_label, qval, [r])</code></pre><p>Convenience wrapper to build a <code>CombinedEFDR</code> method and compute EFDR. <code>original_target_score</code> is accepted for symmetry but not used by Combined.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L208-L213">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.get_complement_score-Tuple{DataFrames.DataFrame, Int64}" href="#PioneerEntrapment.get_complement_score-Tuple{DataFrames.DataFrame, Int64}"><code>PioneerEntrapment.get_complement_score</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_complement_score(prec_results::DataFrame, row_idx::Int; score_col=:score) -&gt; Float64</code></pre><p>Return the best score of the complementary entry within the same entrapment pair.</p><p>Given a row index, this scans all rows with the same <code>:entrapment_pair_id</code> and returns the maximum score among those rows excluding <code>row_idx</code> itself. If the pair ID is missing or no complement exists, returns <code>0.0</code>.</p><p>Required columns</p><ul><li>prec<em>results: `:entrapment</em>pair<em>id<code>,</code>score</em>col`</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/scoring.jl#L1-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.get_paired_efdr" href="#PioneerEntrapment.get_paired_efdr"><code>PioneerEntrapment.get_paired_efdr</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_paired_efdr(score, original_target_score, entrapment_label, qval, [r])</code></pre><p>Convenience wrapper to build a <code>PairedEFDR</code> method and compute EFDR. Use when you already have aligned entrapment and original target scores.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L219-L224">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.plot_efdr_comparison_replicates-Tuple{Vector{DataFrames.DataFrame}, Symbol, Symbol}" href="#PioneerEntrapment.plot_efdr_comparison_replicates-Tuple{Vector{DataFrames.DataFrame}, Symbol, Symbol}"><code>PioneerEntrapment.plot_efdr_comparison_replicates</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Plot EFDR comparison across multiple replicate DataFrames on a single plot. Colors are per method; linestyles per replicate.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/plotting/efdr_plots.jl#L115-L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.run_both_analyses-Tuple{}" href="#PioneerEntrapment.run_both_analyses-Tuple{}"><code>PioneerEntrapment.run_both_analyses</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">run_both_analyses(; precursor_results_path::AbstractString,
                    library_precursors_path::AbstractString,
                    protein_results_path::AbstractString,
                    output_dir::AbstractString = &quot;efdr_out&quot;,
                    r_lib::Float64 = 1.0,
                    plot_formats::Vector{Symbol} = [:png, :pdf],
                    use_fast_paired::Bool = true,
                    verbose::Bool = true)</code></pre><p>Run both the precursor-level and protein-level analyses. Returns a NamedTuple with both results, writing outputs into <code>output_dir/precursor</code> and <code>output_dir/protein</code>.</p><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L1002-L1017">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.run_efdr_analysis-Tuple{String, String}" href="#PioneerEntrapment.run_efdr_analysis-Tuple{String, String}"><code>PioneerEntrapment.run_efdr_analysis</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">run_efdr_analysis(prec_results_path::String, library_precursors_path::String;
                  output_dir::String=&quot;efdr_out&quot;,
                  method_types=[CombinedEFDR, PairedEFDR],
                  score_qval_pairs=[(:global_prob, :global_qval), (:prec_prob, :qval)],
                  r_lib::Float64=1.0,
                  plot_formats=[:png, :pdf],
                  use_fast_paired::Bool=true,
                  verbose::Bool=true)</code></pre><p>Run empirical FDR analysis on precursor-level data with entrapment sequences. Accepts Arrow/CSV inputs for convenience.</p><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L489-L504">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.run_efdr_plots-Tuple{String, String}" href="#PioneerEntrapment.run_efdr_plots-Tuple{String, String}"><code>PioneerEntrapment.run_efdr_plots</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">run_efdr_plots(results_dir::String, library_path::String; output_dir=joinpath(results_dir, &quot;efdr_out&quot;), r_lib=1.0, paired_stride=5, plot_formats=[:png,:pdf], use_fast_paired=true, verbose=true)</code></pre><p>Convenience entry point that looks for standard filenames in <code>results_dir</code>:</p><ul><li>precursors_long.arrow (or .tsv) for precursor-level</li><li>protein<em>groups</em>long.arrow (or .tsv) for protein-level</li></ul><p>Runs the appropriate analyses, writing outputs into <code>output_dir</code> (or subfolders if both).</p><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L251-L261">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.run_efdr_replicate_plots-Tuple{Vector}" href="#PioneerEntrapment.run_efdr_replicate_plots-Tuple{Vector}"><code>PioneerEntrapment.run_efdr_replicate_plots</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">run_efdr_replicate_plots(replicates; output_dir=&quot;efdr_out&quot;, score_qval_pairs=[(:global_prob, :global_qval), (:prec_prob, :qval)], r_lib=1.0, paired_stride=5, plot_formats=[:png,:pdf], use_fast_paired=true, verbose=true)</code></pre><p>Compute EFDR for multiple (precursor<em>results</em>path, library<em>precursors</em>path) replicates and plot on shared figures.</p><p><code>replicates</code> is a Vector of NamedTuples with fields:</p><ul><li><code>precursor_results_path::String</code></li><li><code>library_precursors_path::String</code></li><li><code>label::String</code> (optional, used in plot legend)</li></ul><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L304-L316">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.run_protein_efdr_analysis-Tuple{String}" href="#PioneerEntrapment.run_protein_efdr_analysis-Tuple{String}"><code>PioneerEntrapment.run_protein_efdr_analysis</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">run_protein_efdr_analysis(protein_results_path::String;
                          output_dir::String=&quot;efdr_out&quot;,
                          method_types=[CombinedEFDR, PairedEFDR],
                          score_qval_pairs=[(:global_pg_score, :global_qval), (:pg_score, :qval)],
                          r_lib::Float64=1.0,
                          plot_formats=[:png, :pdf],
                          use_fast_paired::Bool=true,
                          verbose::Bool=true)</code></pre><p>Parameters</p><ul><li>use<em>fast</em>paired: If true (default), use fast O(n log n) implementation for PairedEFDR. If false, use standard O(n²) implementation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/api.jl#L771-L783">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.CombinedEFDR" href="#PioneerEntrapment.CombinedEFDR"><code>PioneerEntrapment.CombinedEFDR</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CombinedEFDR</code></pre><p>Standard combined empirical FDR method that estimates FDR from counts of targets and entrapments seen up to a given score/q-value threshold.</p><p>Fields</p><ul><li>score::Vector{T}: The score used for ordering (higher is better).</li><li>original<em>target</em>score::Vector{T}: Unused by this method; present for API consistency.</li><li>entrapment_label::Vector{I}: 0 for targets; non-zero for entrapments.</li><li>qval::Vector{T}: q-value or confidence score used for tie-breaking.</li><li>r::T: Target:entrapment ratio factor (typically 1.0 for balanced design).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L7-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PioneerEntrapment.PairedEFDR" href="#PioneerEntrapment.PairedEFDR"><code>PioneerEntrapment.PairedEFDR</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">PairedEFDR</code></pre><p>Paired empirical FDR method that accounts for within-pair relationships between an entrapment and its original target score. Uses additional terms to penalize entrapments that either exceed their target or appear when a target is absent at a given cutoff.</p><p>Fields</p><ul><li>score::Vector{T}: The entrapment/test score.</li><li>original<em>target</em>score::Vector{T}: The score of the original target partner.</li><li>entrapment_label::Vector{I}: 0 for targets; non-zero for entrapments.</li><li>qval::Vector{T}: q-value or confidence for ordering/tie-breaks.</li><li>r::T: Target:entrapment ratio factor.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/nwamsley1/PioneerEntrapment.jl/blob/7ce68528a84fddbbded03aadbcb4017027b408f6/src/core/efdr_methods.jl#L35-L49">source</a></section></article><h2 id="Example:-Julia-REPL-on-local-data"><a class="docs-heading-anchor" href="#Example:-Julia-REPL-on-local-data">Example: Julia REPL on local data</a><a id="Example:-Julia-REPL-on-local-data-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Julia-REPL-on-local-data" title="Permalink"></a></h2><p>Run EFDR from a Julia REPL using a .poin library directory (auto-detects <code>precursors_table.arrow</code>) and a results folder with <code>precursors_long.arrow</code>.</p><pre><code class="language-bash hljs">cd /Users/nathanwamsley/Projects/PioneerEntrapment.jl
julia --project=. -q</code></pre><pre><code class="language-julia hljs">using Pkg; Pkg.instantiate()
using PioneerEntrapment

library = &quot;/Users/nathanwamsley/Data/SPEC_LIBS/entrapment_08-20-2025/altimeter_yeast_len7o40_ch2o3_mc1_MTACAstral_Aug302025_entrapR1.poin/altimeter_yeast_len7o40_ch2o3_mc1_MTACAstral_Aug302025_entrapR1.poin.poin&quot;
precursors = &quot;/Users/nathanwamsley/Data/MS_DATA/MTAC_Y_Astral/YEAST_3MIN/MTAC_Y_entrapR1_feature-fix-mbr_D_08-30-2025/precursors_long.arrow&quot;
# If TSV instead, use:
# precursors = &quot;/Users/nathanwamsley/Data/MS_DATA/MTAC_Y_Astral/YEAST_3MIN/MTAC_Y_entrapR1_feature-fix-mbr_D_08-30-2025/precursors_long.tsv&quot;
out = &quot;/Users/nathanwamsley/Data/MS_DATA/MTAC_Y_Astral/YEAST_3MIN/MTAC_Y_entrapR1_feature-fix-mbr_D_08-30-2025/efdr_out&quot;

run_efdr_analysis(precursors, library;
    output_dir=out,
    r_lib=1.0,
    paired_stride=10,      # sampling stride for paired EFDR
    plot_formats=[:png, :pdf],
    verbose=true,
)</code></pre><p>Notes</p><ul><li>Passing the library as the <code>.poin.poin</code> directory is supported; the loader resolves <code>precursors_table.arrow</code> internally.</li><li>Prefer <code>precursors_long.arrow</code> when available; <code>.tsv</code> also works.</li></ul><h2 id="Live-Reload-with-Revise"><a class="docs-heading-anchor" href="#Live-Reload-with-Revise">Live Reload with Revise</a><a id="Live-Reload-with-Revise-1"></a><a class="docs-heading-anchor-permalink" href="#Live-Reload-with-Revise" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Pkg; Pkg.add(&quot;Revise&quot;)
using Revise
using PioneerEntrapment

Revise.includet(&quot;scripts/replicate_plot_example.txt&quot;)

# after edits in src/, just call again
Revise.includet(&quot;scripts/replicate_plot_example.txt&quot;)</code></pre><h2 id="Multi-run-comparison-(replicates)"><a class="docs-heading-anchor" href="#Multi-run-comparison-(replicates)">Multi-run comparison (replicates)</a><a id="Multi-run-comparison-(replicates)-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-run-comparison-(replicates)" title="Permalink"></a></h2><p>Plot EFDR from multiple runs in a single figure (one color per method, solid lines per replicate).</p><pre><code class="language-julia hljs">using PioneerEntrapment

library = &quot;/path/to/library/.poin/.poin&quot;
rep1 = &quot;/path/to/run1/precursors_long.arrow&quot;
rep2 = &quot;/path/to/run2/precursors_long.arrow&quot;

replicates = [
  (precursor_results_path=rep1, library_precursors_path=library, label=&quot;run1&quot;),
  (precursor_results_path=rep2, library_precursors_path=library, label=&quot;run2&quot;),
]

run_efdr_replicate_plots(replicates;
  output_dir=&quot;./efdr_compare&quot;,
  r_lib=1.0,
  paired_stride=10,
  plot_formats=[:png, :pdf],
  verbose=true,
)</code></pre><p>See the output directory for files named like <code>efdr_comparison_replicates_global_prob.png</code>.</p><h3 id="CLI-via-config"><a class="docs-heading-anchor" href="#CLI-via-config">CLI via config</a><a id="CLI-via-config-1"></a><a class="docs-heading-anchor-permalink" href="#CLI-via-config" title="Permalink"></a></h3><pre><code class="language-bash hljs"># JSON
bin/pioneer-entrapment --mode replicates \
  --replicates-config scripts/replicates_example.json \
  --outdir ./efdr_compare --paired-step 10

# YAML (requires YAML.jl)
bin/pioneer-entrapment --mode replicates \
  --replicates-config scripts/replicates_example.yaml \
  --outdir ./efdr_compare --paired-step 10</code></pre><p>JSON expects an array of objects. YAML expects a top-level <code>replicates:</code> list with objects containing <code>precursor_results_path</code>, <code>library_precursors_path</code>, and optional <code>label</code>.</p><h3 id="CLI-(replicates)-with-TOML-config"><a class="docs-heading-anchor" href="#CLI-(replicates)-with-TOML-config">CLI (replicates) with TOML config</a><a id="CLI-(replicates)-with-TOML-config-1"></a><a class="docs-heading-anchor-permalink" href="#CLI-(replicates)-with-TOML-config" title="Permalink"></a></h3><pre><code class="language-bash hljs">JULIA_PROJECT=. bin/pioneer-entrapment --mode replicates \
  --replicates-config scripts/replicates_example.toml \
  --outdir ./efdr_compare --paired-step 10 --plot-formats png,pdf</code></pre><h2 id="Folder-convenience-(both-precursor-and-protein)"><a class="docs-heading-anchor" href="#Folder-convenience-(both-precursor-and-protein)">Folder convenience (both precursor and protein)</a><a id="Folder-convenience-(both-precursor-and-protein)-1"></a><a class="docs-heading-anchor-permalink" href="#Folder-convenience-(both-precursor-and-protein)" title="Permalink"></a></h2><p>Analyze a results folder with standard filenames (precursors<em>long.arrow and/or protein</em>groups_long.arrow):</p><pre><code class="language-julia hljs">using PioneerEntrapment
run_efdr_plots(&quot;/path/to/results&quot;, &quot;/path/to/library/.poin/.poin&quot;;
  output_dir=joinpath(&quot;/path/to/results&quot;, &quot;efdr_out&quot;),
  paired_stride=10,
  plot_formats=[:png, :pdf],
  verbose=true,
)</code></pre><h2 id="Vector-friendly-PDF-output"><a class="docs-heading-anchor" href="#Vector-friendly-PDF-output">Vector-friendly PDF output</a><a id="Vector-friendly-PDF-output-1"></a><a class="docs-heading-anchor-permalink" href="#Vector-friendly-PDF-output" title="Permalink"></a></h2><ul><li>Plots.jl + GR: text set to be editable (<code>GR.setcharquality(0)</code>).</li><li>Default font is Helvetica; override with <code>using Plots; Plots.default(fontfamily=&quot;Arial&quot;)</code> or pass <code>fontfamily</code> to plot calls.</li><li>Include <code>:pdf</code> in <code>plot_formats</code> to save vector PDFs.</li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="entrapment_computation/">Entrapment EFDR »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 14 October 2025 18:44">Tuesday 14 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
